<!DOCTYPE html>
<html lang="en">

{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="{% static 'style.css' %}?version=1">

<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js "></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src=" https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
<script src=" https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


<div class="cov-navbar container-fluid">
    <div class="row">
        <div class="col-lg-2">
            <img width="150px" src="./static/logo.png">
        </div>
        <div class="col-lg-8">
            <h1>COV-19 Forecasting Model</h1>
            <h2>Using Machiene Learning Algorithms</h2>
            <div><a>

                <svg width="20px" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img"
                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-github fa-w-16">
                    <path fill="currentColor"
                          d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"
                          class=""></path>
                </svg>
                Github repository
            </a>


            </div>
            <a>About</a></div>
        <div class="col-lg-2">
            <a href="#">
                <img width="80px" src="./static/fci.png">
                <span>FCIA CU IS-DEPT</span>
            </a>

            <a href="#">
                <img width="80px" src="./static/cairo-uni.png">
                <span>Cairo University</span>
            </a>

        </div>
    </div>
</div>


<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 disclaimer">
    <span>
       represented statistic is based on machine learning in a neural network that has been trained over 540 days,<br> and model is trained automatically after 30 days after last training, by calling data from Jhons Hopkins Uni Github repo   <br>
        Last updated 17 June , 2021 (Pacific Time)
    </span>


        </div>
    </div>
</div>

<div class="container-fluid nav-container ">
    <div class="row">
        <div class="col-lg-12">
            <nav id="my-navbar" class="nav nav-pills flex-column flex-sm-row">
                <a class="flex-sm-fill text-sm-center nav-link " aria-current="page" href="#">Current Situations</a>
                <a class="flex-sm-fill text-sm-center nav-link active" href="#">Forecasting</a>
                <a class="flex-sm-fill text-sm-center nav-link" href="#">Chest X-ray test</a>
            </nav>
        </div>
    </div>
</div>

<div class="container-fluid ">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                <div class="card-header conf-card-header">
                    <h4>Daily Confirmed Cases/ Forecast</h4>
                    <nav>
                        <button class="trend-confirmed active ">
                            Trend
                        </button>
                        <button class="table-confirmed">Tabular</button>
                    </nav>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <div class="row">
                            <div class="col-lg-1 p-0 d-flex justify-content-center  align-items-center">
                                <div class="blob"></div>
                            </div>

                            <div class="col-lg-11">
                                <strong>Warning</strong>
                                <Br/> Al-adha eid is comming!, and a noticeable increase in infection is expected, take
                                care of
                                your health
                            </div>
                        </div>


                    </div>
                    <div id="conf-container" style="width:100%; height:500px;"></div>
                    <table id="conf-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Confirmed Case</th>
                        </tr>
                        </thead>
                        <tbody id="confirmed-cases">
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4>Daily Death/ Forecast</h4>
                </div>
                <div class="card-body">
                    <div id="death-container" style="width:100%; height:400px;"></div>
                    <table id="death-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Death Case</th>
                        </tr>
                        </thead>
                        <tbody id="death-cases">
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4>Daily Recovered/ Forecast</h4>
                </div>
                <div class="card-body">
                    <div id="recov-container" style="width:100%; height:400px;"></div>
                    <table id="recoverd-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Recovered Case</th>
                        </tr>
                        </thead>
                        <tbody id="death-cases">
                        </tbody>
                    </table>

                </div>

            </div>
        </div>
    </div>
</div>

</body>
</html>
<script>
    $(document).ready(function () {

        $('.buttons-csv').addClass('btn-primary')
        $('#conf-table').DataTable(
            {
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            }
        );
        $('#death-table').DataTable(
            {
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            }
        );
    });


    $.fn.dataTable.Buttons.defaults.dom.button.className = 'btn btn-primary mtb-5';


    function getEgyptData() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", 'http://localhost:8000/getegypt/', false); // false for synchronous request
        xmlHttp.send(null);
        return JSON.parse(xmlHttp.response);
    }

    //functions to get forecast
    function getPrediction() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", 'http://localhost:8000/forecastConfirmedCases/', false); // false for synchronous request
        xmlHttp.send(null);
        return JSON.parse(xmlHttp.response);
    }


    function constructGraph() {
        egyptData = getEgyptData()
        egyptForecastData = getPrediction()


        var actualConfirmed = []
        var actualDeath = []
        var actualRecovered = []

        var forecastConfirmed = []
        var forecastConfirmedAdjusted = []

        var forecastDeath = []
        var forecastDeathdAdjusted = []

        var forecastRecovered = []
        var forecastRecoveredAdjusted = []



        for (let i = 520; i < egyptData.length; i++) {

            actualConfirmed.push([new Date(egyptData[i]['Date']).getTime(), egyptData[i]['confirmed_cases']])
            actualDeath.push([new Date(egyptData[i]['Date']).getTime(), egyptData[i]['death_cases']])
            actualRecovered.push([new Date(egyptData[i]['Date']).getTime(), egyptData[i]['recovered_cases']])
        }

        for (let i = 0; i < egyptForecastData['Date'].length; i++) {
            forecastConfirmed.push([new Date(egyptForecastData['Date'][i]).getTime(), Math.round(egyptForecastData['Forecast'][i])])

            forecastConfirmedAdjusted.push([new Date(egyptForecastData['Date'][i]).getTime(), Math.round(egyptForecastData['adjusted'][i])])


        }


        constructConfirmedGraph(actualConfirmed, forecastConfirmed, forecastConfirmedAdjusted)
        {#populateForecastingTable(forecastConfirmed, '#confirmed-cases')#}
        {#constructDeathGraph(actualDeath)#}
        {#constructRecoveredGraph(actualRecovered)#}
    }

    constructGraph()

    function constructConfirmedGraph(observations, forecastData, forecastDataAdjusted) {




        Highcharts.chart('conf-container', configGraph("Actual Confiemed VS Forecast Confirmed Cases",
            observations, '#002147', "Actual Confiemed Cases",
            forecastData, '#0568db', "Forecast Confirmed Cases",
            forecastDataAdjusted, '#e56f06', "Adjusted Forecast Confirmed Cases"
        ))
    }

    function constructDeathGraph(observations) {
        Highcharts.chart('death-container', configGraph("Actual Deaths Cases", observations, '#EF1111', "Actual Deaths Cases"));
    }

    function constructRecoveredGraph(observations) {
        Highcharts.chart('recov-container', configGraph("Actual Recovered Cases", observations, '#01b300', "Actual Recovered Cases"));
    }


    function configGraph(title, actualData, ActualDataSerierscolor, ActualDataSeriersName, forecastData, forecastDataSerierscolor, forecastDataSeriersName, adjustedForecastData, adjsutedDorecastDataSerierscolor, adjustedForecastDataSeriersName) {

        config = {
            tooltip: {
                xDateFormat: '%d/%m/%Y',
                shared: true,
                split: true,
                enabled: true
            },
            chart: {
                type: 'line',
                zoomType: 'x',

            },
            title: {
                text: title
            },
            subtitle: {
                text: 'Source: Johns Hopkins University'
            },
            yAxis: {
                title: {
                    text: 'Death Cases'
                }
            },
            xAxis: {
                type: 'datetime',
                plotLines: [{
                    color: '#FF0000',
                    width: 2,
                    value: 1625616000000

                }]

            },
            legend: {
                layout: 'horizontal',
                align: 'center',
                verticalAlign: 'bottom',
                x: 0,
                y: 0
            },
            series: [
                {
                    name: ActualDataSeriersName,
                    data: actualData,
                    color: ActualDataSerierscolor,
                    dashstyle: 'Dash'
                },
                {
                    name: forecastDataSeriersName,
                    data: forecastData,
                    color: forecastDataSerierscolor,
                },

                {
                    name: adjustedForecastDataSeriersName,
                    data: adjustedForecastData,
                    color: '#d44e10',
                    dashStyle: 'longdash'
                },


            ]
            , plotOptions: {
                series: {
                    compare: 'percent',
                    showInNavigator: true,
                    lineWidth: 3,
                    dataGrouping: {
                        enabled: false
                    },
                }
            },
        }
        return config
    }

    function populateForecastingTable(predictedDate, tableClassName) {

        for (let i = 0; i < predictedDate.length; i++) {
            tableRow = document.createElement('tr')
            CounterData = document.createElement('td')
            dateData = document.createElement('td')
            newConfirmedData = document.createElement('td')
            CounterData.append(i + 1)
            date = new Date(predictedDate[i][0])
            dateData.append(date.getDate(), '/', date.getMonth(), '/', date.getFullYear())
            newConfirmedData.append(Math.ceil(predictedDate[i][1]))
            tableRow.append(CounterData)
            tableRow.append(dateData)
            tableRow.append(newConfirmedData)
            console.log(tableRow)
            console.log($(tableClassName))
            $(tableClassName).prepend(tableRow)
        }
    }


    /*
        window.onscroll = function () {
            myFunction()

        };

        var navbar = document.getElementById("my-navbar");
        var sticky = navbar.offsetTop;

        function myFunction() {
            if (window.pageYOffset >= sticky) {
                console.log("Hi ",navbar)

                navbar.classList.add("sticky")

            } else {
                navbar.classList.remove("sticky");
            }
        }
    */
</script>