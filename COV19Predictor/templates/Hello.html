<!DOCTYPE html>
<html lang="en">

{% load static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="{% static 'style.css' %}?version=1">

<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js "></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src=" https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
<script src=" https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>


<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<nav class="navbar navbar-expand-lg  ">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                   aria-haspopup="true" aria-expanded="false">
                    Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>


<div class="container-fluid">

    <div class="row">
        <div class="col-lg-12 disclaimer">
    <span>
        Our estimates now default to reported deaths in each location, which is the number of deaths officially reported as COVID-19. Select "Excess" to see the number of excess deaths related to COVID-19,<br> which is all deaths estimated as attributed to COVID-19, including unreported deaths. To learn more about our methods, please see our special analysis.
    <br>
        Last updated July 15, 2021 (Pacific Time)
    </span>


        </div>
    </div>
</div>

<div class="container-fluid nav-container ">
    <div class="row">
        <div class="col-lg-12">
            <nav id="my-navbar" class="nav nav-pills flex-column flex-sm-row">
                <a class="flex-sm-fill text-sm-center nav-link active" aria-current="page" href="#">Active</a>
                <a class="flex-sm-fill text-sm-center nav-link" href="#">Longer nav link</a>
                <a class="flex-sm-fill text-sm-center nav-link" href="#">Link</a>
            </nav>
        </div>
    </div>
</div>

<div class="container-fluid ">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                <div class="card-header">
                    <h4>Daily Confirmed Cases/ Forecast</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <div class="blob"></div>

                        <strong>Warning</strong>
                        <Br/> Al-adha eid is comming!, and a noticeable increase in infection is expected, take care of
                        your health
                    </div>
                    <div id="conf-container" style="width:100%; height:500px;"></div>
                    <table id="conf-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Confirmed Case</th>
                        </tr>
                        </thead>
                        <tbody id="confirmed-cases">
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4>Daily Death/ Forecast</h4>
                </div>
                <div class="card-body">
                    <div id="death-container" style="width:100%; height:400px;"></div>
                    <table id="death-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Death Case</th>
                        </tr>
                        </thead>
                        <tbody id="death-cases">
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4>Daily Recovered/ Forecast</h4>
                </div>
                <div class="card-body">
                    <div id="recov-container" style="width:100%; height:400px;"></div>
                    <table id="recoverd-table" class="display table table-striped table-bordered" style="width:100%">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Date</th>
                            <th scope="col">Forecasted New Recovered Case</th>
                        </tr>
                        </thead>
                        <tbody id="death-cases">
                        </tbody>
                    </table>

                </div>

            </div>
        </div>
    </div>
</div>

</body>
</html>
<script>
    $(document).ready(function () {

        $('.buttons-csv').addClass('btn-primary')
        $('#conf-table').DataTable(
            {
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            }
        );
        $('#death-table').DataTable(
            {
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            }
        );
    });


    $.fn.dataTable.Buttons.defaults.dom.button.className = 'btn btn-primary mtb-5';


    /*



    //-------------------------












    */

    function getEgyptData() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", 'http://localhost:8000/getegypt/', false); // false for synchronous request
        xmlHttp.send(null);
        return JSON.parse(xmlHttp.response);
    }

    //functions to get forecast
    function getPrediction() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", 'http://localhost:8000/forecastConfirmedCases/', false); // false for synchronous request
        xmlHttp.send(null);
        return JSON.parse(xmlHttp.response);
    }


    function constructGraph() {
        egyptData = getEgyptData()
        egyptForecastData = getPrediction()


        var actualConfirmed = []
        var actualDeath = []
        var actualRecovered = []
        var forecastConfirmed = []


        for (let i = 520; i < egyptData.length; i++) {

            actualConfirmed.push([new Date(egyptData[i]['fields']['Date']).getTime(), egyptData[i]['fields']['confirmed_cases']])
            actualDeath.push([new Date(egyptData[i]['fields']['Date']).getTime(), egyptData[i]['fields']['death_cases']])
            actualRecovered.push([new Date(egyptData[i]['fields']['Date']).getTime(), egyptData[i]['fields']['recovered_cases']])
        }

        for (let i = 0; i < egyptForecastData['Date'].length; i++) {
            forecastConfirmed.push([new Date(egyptForecastData['Date'][i]).getTime(), Math.round( egyptForecastData['Forecast'][i]) ])
        }


        constructConfirmedGraph(actualConfirmed, forecastConfirmed)
        populateForecastingTable(forecastConfirmed,'#confirmed-cases')
        constructDeathGraph(actualDeath)
        constructRecoveredGraph(actualRecovered)
    }

    constructGraph()

    function constructConfirmedGraph(observations, forecastData) {
        console.log('forecat data is', forecastData)
        Highcharts.chart('conf-container', configGraph("Actual Confiemed Cases", observations, '#002147', "Actual Confiemed Cases", forecastData, '#0568db', "Forecast Confirmed Cases"))
    }

    function constructDeathGraph(observations) {
        Highcharts.chart('death-container', configGraph("Actual Deaths Cases", observations, '#EF1111', "Actual Deaths Cases"));
    }

    function constructRecoveredGraph(observations) {
        Highcharts.chart('recov-container', configGraph("Actual Recovered Cases", observations, '#01b300', "Actual Recovered Cases"));
    }


    function configGraph(title, actualData, ActualDataSerierscolor, ActualDataSeriersName, forecastData, forecastDataSerierscolor, forecastDataSeriersName) {

        config = {
            tooltip: {
                xDateFormat: '%d/%m/%Y',
                shared: true,
                split: true,
                enabled: true
            },
            chart: {
                type: 'line',
                zoomType: 'x',

            },
            title: {
                text: title
            },
            subtitle: {
                text: 'Source: Johns Hopkins University'
            },
            yAxis: {
                title: {
                    text: 'Death Cases'
                }
            },
            xAxis: {
                type: 'datetime',

            },
            legend: {
                layout: 'horizontal',
                align: 'center',
                verticalAlign: 'bottom',
                x: 0,
                y: 0
            },
            series: [{
                name: ActualDataSeriersName,
                data: actualData,
                color: ActualDataSerierscolor,
                dashstyle:'Dash'
            },
                {
                    name: forecastDataSeriersName,
                    data: forecastData,
                    color: forecastDataSerierscolor,
                },]
            , plotOptions: {
                series: {
                    compare: 'percent',
                    showInNavigator: true,
                    lineWidth: 3,
                    dataGrouping: {
                        enabled: false
                    },
                }
            },
        }
        return config
    }

        function populateForecastingTable(predictedDate, tableClassName) {

        for (let i = 0; i < predictedDate.length; i++) {
            tableRow = document.createElement('tr')
            CounterData = document.createElement('td')
            dateData = document.createElement('td')
            newConfirmedData = document.createElement('td')
            CounterData.append(i + 1)
            date = new Date (predictedDate[i][0])
            dateData.append(date.getDate(),'/',date.getMonth(),'/',date.getFullYear())
            newConfirmedData.append(Math.ceil(predictedDate[i][1]))
            tableRow.append(CounterData)
            tableRow.append(dateData)
            tableRow.append(newConfirmedData)
            console.log(tableRow)
            console.log($(tableClassName))
            $(tableClassName).prepend(tableRow)
        }
    }



    /*
        window.onscroll = function () {
            myFunction()

        };

        var navbar = document.getElementById("my-navbar");
        var sticky = navbar.offsetTop;

        function myFunction() {
            if (window.pageYOffset >= sticky) {
                console.log("Hi ",navbar)

                navbar.classList.add("sticky")

            } else {
                navbar.classList.remove("sticky");
            }
        }
    */
</script>